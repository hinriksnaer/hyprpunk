# Autostart Applications
# Programs to run on Hyprland startup

# Essential services first
# Import all critical Wayland/toolkit environment variables into systemd user session
# This ensures systemd user services (like elephant, pipewire, mako) have proper Wayland support
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP XDG_SESSION_TYPE XDG_SESSION_DESKTOP GDK_BACKEND QT_QPA_PLATFORM SDL_VIDEODRIVER CLUTTER_BACKEND MOZ_ENABLE_WAYLAND QT_AUTO_SCREEN_SCALE_FACTOR QT_WAYLAND_DISABLE_WINDOWDECORATION QT_QPA_PLATFORMTHEME GTK_THEME QT_STYLE_OVERRIDE
exec-once = hyprpolkitagent
# Mako notification daemon is managed by systemd (mako.service)

# Set dark mode preference for GTK/GNOME apps
exec-once = gsettings set org.gnome.desktop.interface color-scheme 'prefer-dark'
exec-once = gsettings set org.gnome.desktop.interface gtk-theme 'Adwaita-dark'

# Wallpaper with fallbacks
# 1. Try current theme wallpaper
# 2. Fall back to fedpunk current background symlink
# 3. Fall back to default solid color if all else fails
exec-once = bash -c 'if [[ -f ~/.config/hypr/wallpapers/current ]]; then swaybg -i ~/.config/hypr/wallpapers/current -m fill; elif [[ -f ~/.config/fedpunk/current/background ]]; then swaybg -i ~/.config/fedpunk/current/background -m fill; else swaybg -c "#1e1e1e"; fi'

# Network management
exec-once = nm-applet

# Laptop-specific applications (only start if available)
# Power management applet for laptops
exec-once = bash -c 'if command -v xfce4-power-manager >/dev/null 2>&1; then xfce4-power-manager; fi'

# Waybar status bar
exec-once = waybar

# Initialize default theme if none exists, then apply theme
exec-once = sleep 2 && bash -c 'if [[ ! -f ~/.config/kitty/theme.conf ]]; then ~/.local/bin/hyprpunk-theme-set ayu-mirage 2>/dev/null || true; fi; ~/.local/bin/hyprpunk-theme-refresh 2>/dev/null || true'

# Restore saved layout preference (after theme applies)
exec-once = sleep 3 && fish ~/.config/hypr/scripts/restore-layout.fish

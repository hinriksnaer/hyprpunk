#!/usr/bin/env fish
# Fedpunk Reload Script
# Reloads Hyprland and related services after configuration changes

set fedpunk_dir "$HOME/.local/share/fedpunk"

echo "ğŸ”„ Fedpunk Reload"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# Check for uncommitted changes
cd $fedpunk_dir
if test -n "$(git status --porcelain)"
    echo "âš ï¸  Warning: You have uncommitted changes in $fedpunk_dir"
    git status --short
    echo ""
end

echo ""

# Reload Hyprland
echo "ğŸªŸ Reloading Hyprland..."
if hyprctl reload >/dev/null 2>&1
    echo "âœ“ Hyprland reloaded"
else
    echo "âœ— Hyprland reload failed (not running?)"
end

# Reload Waybar
echo "ğŸ“Š Reloading Waybar..."
if pkill -SIGUSR2 waybar
    echo "âœ“ Waybar reloaded"
else
    echo "âœ— Waybar reload failed (not running?)"
end

# Reload Mako (notification daemon)
echo "ğŸ”” Reloading Mako..."
if pgrep -x mako >/dev/null 2>&1
    if killall -SIGUSR2 mako
        echo "âœ“ Mako reloaded"
    else
        echo "âœ— Mako reload failed"
    end
else
    echo "âŠ Mako not running"
end

# Reload Kitty (if running)
echo "ğŸ± Reloading Kitty..."
if pgrep -x kitty >/dev/null 2>&1
    if killall -SIGUSR1 kitty
        echo "âœ“ Kitty config reloaded"
    else
        echo "âœ— Kitty reload failed"
    end
else
    echo "âŠ Kitty not running"
end

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ¨ Reload complete!"
echo ""
echo "Note: Configuration changes are live via Stow symlinks."
echo "This script only reloads running services to pick up changes."
